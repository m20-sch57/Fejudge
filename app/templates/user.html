{% extends 'base.html' %}

{% block app_content %}
<div class="container-fluid window">
    <div class="container">
        <div class="row">
            <div class="col-lg-5">
                <div class="mt-3 mb-5 text-center">
                    <h2>{{ user.username }}</h2>
                </div>
                <div class="mb-3 text-center">
                    <img src="/avatars/{{ user.avatar }}" class="rounded-circle image-lg">
                </div>
                {% if current_user == user %}
                <div class="mb-5 text-center">
                    <button type="button" class="btn btn-link"
                    data-toggle="modal" data-target="#changeAvatar">
                        Изменить аватар
                    </button>
                </div>
                {% endif %}
            </div>
            <div class="col-lg-7">
                <div class="mt-3 mb-5 text-center">
                    <h2>Учётные данные</h2>
                </div>
                <div class="d-flex flex-wrap">
                    <div class="mb-3 mr-auto">
                        <div class="d-flex flex-wrap">
                            <h2 class="align-self-center profile-cell-picture">
                                <span class="fa fa-address-card"></span>
                            </h2>
                            <p class="align-self-center m-2 mr-auto">
                                {{ user.fullname }}
                            </p>
                        </div>
                        <div class="d-flex flex-wrap">
                            <p class="align-self-center profile-cell-picture">
                                <span class="fa fa-birthday-cake"></span>
                            </p>
                            <p class="align-self-center m-2 mr-auto">
                                {{ user.birthdate }}
                            </p>
                        </div>
                        <div class="d-flex flex-wrap">
                            <p class="align-self-center profile-cell-picture">
                                <span class="fa fa-envelope"></span>
                            </p>
                            <p class="align-self-center m-2 mr-auto">
                                {{ user.email }}
                            </p>
                        </div>
                        <div class="d-flex flex-wrap">
                            <p class="align-self-center profile-cell-picture">
                                <span class="fa fa-phone-alt"></span>
                            </p>
                            <p class="align-self-center m-2 mr-auto">
                                {{ user.phone }}
                            </p>
                        </div>
                    </div>
                    {% if current_user == user %}
                    <div class="my-auto m-3">
                        <button type="button" class="btn btn-lg btn-info btn-shadow m-3"
                        data-toggle="modal" data-target="#changeProfile">
                            <span class="fa fa-pencil"></span> Редактировать
                        </button>
                        <button type="button" class="btn btn-block btn-link"
                        data-toggle="modal" data-target="#changePassword">
                            Изменить пароль
                        </button>
                        <a class="btn btn-block btn-link" href="/restorePassword">
                            Восстановить пароль
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="changeAvatar">
    <div class="modal-lg modal-dialog centered">
        <div class="modal-content">
            <form action="/changeAvatar" method="POST" enctype="multipart/form-data" novalidate>
                {{ avatar_form.hidden_tag() }}
                <div class="modal-header">
                    <h5 class="modal-title">Изменить аватар</h5>
                    <button class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="d-flex" id="dropArea">
                        <span>Перетащите изображение сюда или выберите файл на вашем устройстве.</span>
                    </div>
                </div>
                <div class="modal-footer flex-wrap justify-content-between">
                    {{ avatar_form.image(id="fileUpload", accept="image/*", hidden="") }}
                    <label for="fileUpload" class="btn btn-primary btn-shadow my-1">
                        Выбрать файл
                    </label>
                    <label class="p-1 mr-auto my-auto" id="fileUploadLabel">
                        Файл не выбран
                    </label>
                    <button type="submit" id="submitAvatar" class="btn btn-success btn-shadow my-1" disabled>
                        Сохранить
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="changeProfile">
    <div class="modal-lg modal-dialog centered">
        <div class="modal-content">
            <form action="/changeProfile" method="POST" novalidate>
                {{ profile_form.hidden_tag() }}
                <div class="modal-header">
                    <h5 class="modal-title">Профиль пользователя {{ user.username }}</h5>
                    <button class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <div class="col-lg-3">
                            {{ profile_form.fullname.label(class='col-form-label') }}
                        </div>
                        <div class="col-lg-9">
                            {{ profile_form.fullname(class='form-control', value=user.fullname) }}
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-3">
                            {{ profile_form.birthdate.label(class='col-form-label') }}
                        </div>
                        <div class="col-lg-9">
                            {{ profile_form.birthdate(class='form-control', value=user.birthdate) }}
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-3">
                            {{ profile_form.email.label(class='col-form-label') }}
                        </div>
                        <div class="col-lg-9">
                            {{ profile_form.email(class='form-control', value=user.email) }}
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-3">
                            {{ profile_form.phone.label(class='col-form-label') }}
                        </div>
                        <div class="col-lg-9">
                            {{ profile_form.phone(class='form-control', value=user.phone) }}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success btn-shadow">Сохранить</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="changePassword">
    <div class="modal-lg modal-dialog centered">
        <div class="modal-content">
            <form action="/changePassword" method="POST" novalidate>
                {{ password_form.hidden_tag() }}
                <div class="modal-header">
                    <h5 class="modal-title">Изменить пароль</h5>
                    <button class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <div class="col-lg-3">
                            {{ password_form.old_password.label(class='col-form-label') }}
                        </div>
                        <div class="col-lg-9">
                            {{ password_form.old_password(class='form-control', placeholder='Old password') }}
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-3">
                            {{ password_form.new_password.label(class='col-form-label') }}
                        </div>
                        <div class="col-lg-9">
                            {{ password_form.new_password(class='form-control', placeholder='New password') }}
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-3">
                            {{ password_form.new_password2.label(class='col-form-label') }}
                        </div>
                        <div class="col-lg-9">
                            {{ password_form.new_password2(class='form-control', placeholder='New password') }}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success btn-shadow">Изменить пароль</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="/static/js/avatar.js"></script>
{% endblock %}
